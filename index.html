<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="宽恕不会改变那个过去,却能开阔你的未来">
<meta property="og:type" content="website">
<meta property="og:title" content="陈春勇的博客">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="陈春勇的博客">
<meta property="og:description" content="宽恕不会改变那个过去,却能开阔你的未来">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="陈春勇的博客">
<meta name="twitter:description" content="宽恕不会改变那个过去,却能开阔你的未来">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title> 陈春勇的博客 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">陈春勇的博客</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">用行动说话</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-guestbook">
          <a href="/guestbook" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-pencil"></i> <br />
            
            留言
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/15/谈谈我对event-loop的理解/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="陈春勇">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="陈春勇的博客">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="陈春勇的博客" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/03/15/谈谈我对event-loop的理解/" itemprop="url">
                  谈谈我对event loop的理解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-15T17:17:34+08:00">
                2018-03-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2018/03/15/谈谈我对event-loop的理解/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/03/15/谈谈我对event-loop的理解/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在前端学习过程中，对event loop的理解是一个难点，也是一个比较有趣的点，下面谈谈我对event loop的理解。</p>
<h2 id="event-loop-理解"><a href="#event-loop-理解" class="headerlink" title="event loop 理解"></a>event loop 理解</h2><p>根据W3C 对<a href="https://www.w3.org/TR/html5/webappapis.html#event-loop" target="_blank" rel="external">event loop</a>规范我总结了下:</p>
<ol>
<li>一个event loop有<strong>一个或者多个</strong>任务队列；</li>
<li>一个任务队列是一系列<strong>有序</strong> task集合；</li>
<li>每一个task都有添加到队列时，必须添加到event loop对应的某个队列中；</li>
<li>每一个task在定义时都会有指定的task source（一共有4种，DOM manipulation task source，user interaction task source，networking task source，history traversal task source）。所有来自一个特定的task source的task都必须被添加到一个特定的相同的event loop，但是<strong>不同来自不同task source的task也许会被添加到不同的任务队列</strong>；</li>
<li>每个(task source对应的)task queue都保证自己队列的先进先出的执行顺序，是由浏览器决定从哪个task source挑选task。这允许浏览器为不同的task source设置不同的优先级，比如为用户交互设置更高优先级来使用户感觉流畅。<strong>task执行的优先级具体由游览器自行决定。</strong></li>
</ol>
<h2 id="microtask-队列理解"><a href="#microtask-队列理解" class="headerlink" title="microtask 队列理解"></a>microtask 队列理解</h2><p>根据W3C 对<a href="https://www.w3.org/TR/html51/webappapis.html#microtask" target="_blank" rel="external">microtask</a>我的理解如下:</p>
<ol>
<li>每一个event loop都有一个microtask队列，处于microtask队列而不是普通的task队列中的task就叫做microtask；</li>
<li><strong>microtask队列的执行顺序优先于普通的task队列</strong>。</li>
</ol>
<p>当前属于microtask的有：<strong>process.nextTick, Promises, Object.observe(废弃), MutationObserver</strong>。</p>
<h2 id="浏览器中event-loop-运行机制"><a href="#浏览器中event-loop-运行机制" class="headerlink" title="浏览器中event loop 运行机制"></a>浏览器中event loop 运行机制</h2><p>根据W3C <a href="https://www.w3.org/TR/html51/webappapis.html#event-loops-processing-model" target="_blank" rel="external">event loop processing model</a>来描述浏览器的事件循环的进程模型：</p>
<ol>
<li>取出某一个任务队列队列头的任务（如果存在的话），如果没有task可以取的话，跳到第6步；</li>
<li>将event loop的当前运行任务设置为上一步选择到的task；</li>
<li>运行这个task；</li>
<li>将event loop的当前运行任务设置为null；</li>
<li>将第3步中运行的task从它的任务队列中移除；</li>
<li>执行一个microtask checkpoint操作;</li>
<li>更新渲染。</li>
</ol>
<p>简单可以总结为：先执行microtask，然后执行普通task。</p>
<h2 id="验证event-loop-运行机制"><a href="#验证event-loop-运行机制" class="headerlink" title="验证event loop 运行机制"></a>验证event loop 运行机制</h2><p>下面我们用一个比较复杂的demo来验证event loop 运行机制，此demo 涉及的类型有：DOM event、settimeout、Promise、XMLHttpRequest。</p>
<p>代码如下 <a href="/images/eventloop/testpage.html">demo</a>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'start test...'</span>);</span><br><span class="line"><span class="comment">// 添加</span></span><br><span class="line">setTimeout(() =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"settimeout 1"</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// request 请求</span></span><br><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"><span class="comment">//请求某个页面，如果出现跨域，则需自己调整</span></span><br><span class="line">xhr.open(<span class="string">'GET'</span>, <span class="string">'/images/avatar.png'</span>, <span class="literal">true</span>);</span><br><span class="line">xhr.onload = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.status == <span class="number">200</span> || <span class="keyword">this</span>.status == <span class="number">304</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"request response..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">xhr.send();</span><br><span class="line"><span class="comment">// 注册页面中的点击事件，主要在主进程阻塞3s内单击</span></span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'btn'</span>).addEventListener(<span class="string">'click'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'click'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//promise </span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>((resolve, reject) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"promise 1"</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">        i=<span class="number">9999</span> &amp;&amp;resolve();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"promise 2"</span>);</span><br><span class="line">&#125;).then(()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"promise 3"</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">let</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line"><span class="keyword">while</span> ((<span class="keyword">new</span> <span class="built_in">Date</span>()).getTime() - now &lt; <span class="number">3000</span>) &#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"last test..."</span>);</span><br></pre></td></tr></table></figure>
<p>运行的结果如下：</p>
<p><img src="/images/eventloop/结果.png" alt=""></p>
<p>那么是如何得到这个结果呢，分析如下：</p>
<ol>
<li>先打印：start test…（没什么好说的)；</li>
<li>添加“打印 settimeout 1”回调 到 task队列中（改天跟大家分享settimeout运行原理，参考：<a href="http://www.alloyteam.com/2015/10/turning-to-javascript-series-from-settimeout-said-the-event-loop-model/" target="_blank" rel="external">settimeout 原理</a>）；</li>
<li>发起页面请求，等待页面请求完成后，把“onload 回调“push到task队列中;</li>
<li>执行Promise构造函数 打印出：promise 1，promise 2；</li>
<li>构造函数中循环1000次，运行then的方法，添加 “打印 promise 3 回调” push到microtask 队列中；</li>
<li>在3秒期间，单击页面的click事件，把”打印 click 回调“push到队列中；</li>
<li>主进程等待3s后，打印出 last test…；</li>
<li>由于microtask的task会比较早执行，优先从microtask 队列拿出task，打印出 promise 3；</li>
<li>Chrome为了用户体验，提升交互，把click 产生的task &gt; 大于发起请求的task &gt; settimeout 产生的task，所以依次打印出：click，request response…，settimeout 1。</li>
</ol>
<p><strong>PS：</strong> </p>
<ol>
<li>由于第9点是我在Chrome下运行的结果，可能其他游览器返回结果不一定一致；</li>
<li>上述所说的push到task队列中，不是指一个队列，而是某个类型的task队列，不同类型的task 队列 执行的优先级不一致，目前我没有找到相关task任务优先级的文章。</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li>event loop涉及到一般的task队列与macrotask队列；</li>
<li>macrotask队列中的task 执行的优先级高于task队列的task；</li>
<li>即使是不同的task队列，都有执行的优先级，执行的优先级主要以用户交互、体验为考虑依据。</li>
</ol>
<p>以上的理解纯属我个人对event loop 的理解，有问题还请大家多多指正。</p>
<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/23/算法（1）-快速排序算法/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="陈春勇">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="陈春勇的博客">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="陈春勇的博客" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/23/算法（1）-快速排序算法/" itemprop="url">
                  算法（1）--快速排序算法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-23T13:59:00+08:00">
                2017-05-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/算法/" itemprop="url" rel="index">
                    <span itemprop="name">算法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/05/23/算法（1）-快速排序算法/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/05/23/算法（1）-快速排序算法/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="算法（1）–快速排序算法"><a href="#算法（1）–快速排序算法" class="headerlink" title="算法（1）–快速排序算法"></a>算法（1）–快速排序算法</h1><p>快速排序的思想：采用分治思想，找到<strong>基准数</strong>，以基准数为中心，将小于基准数都放住左边，大于基准数都放右边。</p>
<p>复杂度：最坏的情况下复杂度为：<strong>O(N2)</strong>；平均复杂度为：<strong>O(NlogN)</strong>。</p>
<p>具体代码如下（采用JavaScript实现）：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> inputs = [<span class="number">5</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">quickSort</span>(<span class="params">left, right</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (left &gt; right) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> i = left;</span><br><span class="line">    <span class="keyword">let</span> j = right;</span><br><span class="line">    <span class="keyword">let</span> t;</span><br><span class="line">    temp = inputs[left]; <span class="comment">//存储基准数</span></span><br><span class="line">    <span class="keyword">while</span> (i != j) &#123;</span><br><span class="line">        <span class="comment">// 从右边开始找，直到找到小于等于基准线为止</span></span><br><span class="line">        <span class="keyword">while</span> (inputs[j] &gt;= temp &amp;&amp; i &lt; j) &#123;</span><br><span class="line">            j--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 从左边开始查找，直到找到小于基准线</span></span><br><span class="line">        <span class="keyword">while</span> (inputs[i] &lt;= temp &amp;&amp; i &lt; j) &#123;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 当哨兵i与哨兵j没有相遇，交换i,j位置</span></span><br><span class="line">        <span class="keyword">if</span> (i &lt; j) &#123;</span><br><span class="line">            t = inputs[i];</span><br><span class="line">            inputs[i] = inputs[j];</span><br><span class="line">            inputs[j] = t;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 归位基准线位置</span></span><br><span class="line">    inputs[left] = inputs[i];</span><br><span class="line">    inputs[i] = temp;</span><br><span class="line">    quickSort(left, i - <span class="number">1</span>); <span class="comment">//处理左边</span></span><br><span class="line">    quickSort(i + <span class="number">1</span>, right); <span class="comment">//处理右边</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'未排序：'</span>, inputs);</span><br><span class="line">quickSort(<span class="number">0</span>, inputs.length - <span class="number">1</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'排序后：'</span>, inputs);</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/01/react-高阶函数/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="陈春勇">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="陈春勇的博客">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="陈春勇的博客" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/01/react-高阶函数/" itemprop="url">
                  react 高阶组件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-01T15:30:56+08:00">
                2017-03-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/03/01/react-高阶函数/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/03/01/react-高阶函数/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="react-高阶组件"><a href="#react-高阶组件" class="headerlink" title="react 高阶组件"></a>react 高阶组件</h1><h2 id="什么是高阶组件？"><a href="#什么是高阶组件？" class="headerlink" title="什么是高阶组件？"></a>什么是高阶组件？</h2><p>react高阶组件主要目的是让原有的组件扩展出其他功能，主要是通过闭包与函数的方式，改变原有组件的行为。我们可以通过编写高阶组件来达到不修改原组件的代码就能增强组件的目的。<br>高阶组件的定义如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HOC: ReactComponent -&gt; ReactComponent</span><br></pre></td></tr></table></figure></p>
<p>demo:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function HOC(WrappedComponent) &#123;</span><br><span class="line">  return class PP extends React.Component &#123;</span><br><span class="line">    const newProps = &#123;</span><br><span class="line">        user: myUser,</span><br><span class="line">    &#125;;</span><br><span class="line">    render() &#123;</span><br><span class="line">      return &lt;WrappedComponent &#123;...this.props&#125; &#123;...newProps&#125;/&gt;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>往<code>WrappedComponent</code>组件中新增了属性<code>user</code>。</p>
<h2 id="高阶组件的用途"><a href="#高阶组件的用途" class="headerlink" title="高阶组件的用途"></a>高阶组件的用途</h2><ul>
<li>代码复用，抽象程序内部逻辑（logic and bootstrap abstraction）</li>
<li>渲染劫持（Render Highjacking）</li>
<li>提取和操作 state</li>
<li>操作 props</li>
</ul>
<h2 id="高阶组件的实际应用"><a href="#高阶组件的实际应用" class="headerlink" title="高阶组件的实际应用"></a>高阶组件的实际应用</h2><p>通过分析<code>react-redux</code>源码来看看高阶组件的实际定义。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">export function createConnect(&#123;</span><br><span class="line">  connectHOC = connectAdvanced,</span><br><span class="line">  mapStateToPropsFactories = defaultMapStateToPropsFactories,</span><br><span class="line">  mapDispatchToPropsFactories = defaultMapDispatchToPropsFactories,</span><br><span class="line">  mergePropsFactories = defaultMergePropsFactories,</span><br><span class="line">  selectorFactory = defaultSelectorFactory</span><br><span class="line">&#125; = &#123;&#125;) &#123;</span><br><span class="line">  return function connect(</span><br><span class="line">    mapStateToProps,</span><br><span class="line">    mapDispatchToProps,</span><br><span class="line">    mergeProps,</span><br><span class="line">    &#123;</span><br><span class="line">      pure = true,</span><br><span class="line">      areStatesEqual = strictEqual,</span><br><span class="line">      areOwnPropsEqual = shallowEqual,</span><br><span class="line">      areStatePropsEqual = shallowEqual,</span><br><span class="line">      areMergedPropsEqual = shallowEqual,</span><br><span class="line">      ...extraOptions</span><br><span class="line">    &#125; = &#123;&#125;</span><br><span class="line">  ) &#123;</span><br><span class="line">    const initMapStateToProps = match(mapStateToProps, mapStateToPropsFactories, &apos;mapStateToProps&apos;)</span><br><span class="line">    const initMapDispatchToProps = match(mapDispatchToProps, mapDispatchToPropsFactories, &apos;mapDispatchToProps&apos;)</span><br><span class="line">    const initMergeProps = match(mergeProps, mergePropsFactories, &apos;mergeProps&apos;)</span><br><span class="line"></span><br><span class="line">    return connectHOC(selectorFactory, &#123;</span><br><span class="line">      // used in error messages</span><br><span class="line">      methodName: &apos;connect&apos;,</span><br><span class="line"></span><br><span class="line">       // used to compute Connect&apos;s displayName from the wrapped component&apos;s displayName.</span><br><span class="line">      getDisplayName: name =&gt; `Connect($&#123;name&#125;)`,</span><br><span class="line"></span><br><span class="line">      // if mapStateToProps is falsy, the Connect component doesn&apos;t subscribe to store state changes</span><br><span class="line">      shouldHandleStateChanges: Boolean(mapStateToProps),</span><br><span class="line"></span><br><span class="line">      // passed through to selectorFactory</span><br><span class="line">      initMapStateToProps,</span><br><span class="line">      initMapDispatchToProps,</span><br><span class="line">      initMergeProps,</span><br><span class="line">      pure,</span><br><span class="line">      areStatesEqual,</span><br><span class="line">      areOwnPropsEqual,</span><br><span class="line">      areStatePropsEqual,</span><br><span class="line">      areMergedPropsEqual,</span><br><span class="line"></span><br><span class="line">      // any extra options args can override defaults of connect or connectAdvanced</span><br><span class="line">      ...extraOptions</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default createConnect()</span><br></pre></td></tr></table></figure>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://qianduan.guru/2017/01/11/react-higher-order-components-in-depth" target="_blank" rel="external">http://qianduan.guru/2017/01/11/react-higher-order-components-in-depth</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/10/webpack-dllPlugin-使用/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="陈春勇">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="陈春勇的博客">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="陈春勇的博客" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/10/webpack-dllPlugin-使用/" itemprop="url">
                  webpack dllPlugin 使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-10T10:59:59+08:00">
                2017-01-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/01/10/webpack-dllPlugin-使用/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/10/webpack-dllPlugin-使用/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="webpack-dllPlugin-使用"><a href="#webpack-dllPlugin-使用" class="headerlink" title="webpack dllPlugin 使用"></a>webpack dllPlugin 使用</h1><h2 id="CommonsChunk"><a href="#CommonsChunk" class="headerlink" title="CommonsChunk"></a>CommonsChunk</h2><p>前端构建项目中，为了提高打包效率，往往将第三库与业务逻辑代码分开打包，因为第三方库往往不需要经常打包更新。webpack建议使用<code>CommonsChunk</code> 来单独打包第三方库：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        vendor: [<span class="string">'react'</span>,<span class="string">'react-dom'</span>],</span><br><span class="line">        app: <span class="string">"./main"</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: <span class="string">'./build'</span>,</span><br><span class="line">        filename: <span class="string">'[name].js'</span>,</span><br><span class="line">        library: <span class="string">'[name]_library'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> CommonsChunkPlugin(&#123;</span><br><span class="line">            name: <span class="string">"vendor"</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p><code>CommonsChunk</code>虽然可以减少包的大小，但存在问题是：即使代码不更新，每次重新打包，vendor都会重新生成，不符合我们分离第三方包的初衷。</p>
<h2 id="Externals"><a href="#Externals" class="headerlink" title="Externals"></a>Externals</h2><p>相比于前者，webpack 提供<code>Externals</code>的方法，可以通过外部引用的方法，引入第三方库：<br>index.html<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://code.jquery.com/jquery-3.1.0.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>webpack.config.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">   externals: &#123;</span><br><span class="line">     jquery: <span class="string">'jQuery'</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>业务逻辑，如index.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import $ from &apos;jquery&apos;;</span><br><span class="line">$(&apos;.my-element&apos;).animate(...);</span><br></pre></td></tr></table></figure></p>
<p>webpack打包时，发现jquery定义在<code>externals</code>，则不会打包jquery代码。由于不需要打包jquery，所以也减少打包时间。<br>不过<code>externals</code>虽然解决了外部引用问题，但是无法解决以下问题：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import xxx from &apos;react/src/xx&apos;;</span><br></pre></td></tr></table></figure></p>
<p>webpack遇到此问题时，会重新打包react代码。<br>参考：<a href="https://gold.xitu.io/entry/57996222128fe1005411c649" target="_blank" rel="external">https://gold.xitu.io/entry/57996222128fe1005411c649</a></p>
<h2 id="DLL-amp-DllReference"><a href="#DLL-amp-DllReference" class="headerlink" title="DLL &amp; DllReference"></a>DLL &amp; DllReference</h2><p>相比于前者，通过前置这些依赖包的构建，来提高真正的build和rebuild构建效率。也就是说只要第三方库没有变化，之后的每次build都只需要去打包自己的业务代码，解决<code>Externals</code>多次引用问题。<br>webpack通过<code>webpack.DllPlugin</code>与<code>webpack.DllReferencePlugin</code>两个内嵌插件实现此功能。</p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>1、新建webpack.dll.config.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">const webpack = require(&apos;webpack&apos;);</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        bundle: [</span><br><span class="line">            &apos;react&apos;,</span><br><span class="line">            &apos;react-dom&apos;,</span><br><span class="line">            //其他库</span><br><span class="line">            ],</span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: &apos;./build&apos;,</span><br><span class="line">        filename: &apos;[name].js&apos;,</span><br><span class="line">        library: &apos;[name]_library&apos;</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        new webpack.DllPlugin(&#123;</span><br><span class="line">            path: &apos;./build/bundle.manifest.json&apos;,</span><br><span class="line">            name: &apos;[name]_library&apos;,</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p><code>webpack.DllPlugin</code>选项：</p>
<ul>
<li><strong>path</strong>：manifest.json文件的输出路径，这个文件会用于后续的业务代码打包；</li>
<li><strong>name</strong>：dll暴露的对象名，要跟output.library保持一致;</li>
<li><strong>context</strong>：解析包路径的上下文，这个要跟接下来配置的 webpack.config.js 一致。</li>
</ul>
<p>运行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webpack --config webpack.dll.config.js</span><br></pre></td></tr></table></figure></p>
<p>生成两个文件，一个是打包好的<code>bundlejs</code>，另外一个是<code>bundle.mainifest.json</code>，大致内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;bundle_library&quot;,</span><br><span class="line">  &quot;content&quot;: &#123;</span><br><span class="line">    &quot;./node_modules/react/react.js&quot;: 1,</span><br><span class="line">    &quot;./node_modules/react/lib/React.js&quot;: 2,</span><br><span class="line">    &quot;./node_modules/process/browser.js&quot;: 3,</span><br><span class="line">    &quot;./node_modules/object-assign/index.js&quot;: 4,</span><br><span class="line">    &quot;./node_modules/react/lib/ReactChildren.js&quot;: 5,</span><br><span class="line">    &quot;./node_modules/react/lib/PooledClass.js&quot;: 6,</span><br><span class="line">    &quot;./node_modules/react/lib/reactProdInvariant.js&quot;: 7,</span><br><span class="line">    //其他引用</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>2、配置webpack.config.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">const webpack = require(&apos;webpack&apos;);</span><br><span class="line">var path = require(&apos;path&apos;);</span><br><span class="line">module.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    main: &apos;./main.js&apos;,</span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.join(__dirname, &quot;build&quot;),</span><br><span class="line">    publicPath: &apos;./&apos;,</span><br><span class="line">    filename: &apos;[name].js&apos;</span><br><span class="line">  &#125;,</span><br><span class="line">  module: &#123;</span><br><span class="line">    loaders:[</span><br><span class="line">      &#123; test: /\.(png|jpg)$/, loader: &apos;url-loader?limit=8192&apos;&#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: /\.jsx?$/,</span><br><span class="line">        loaders: [&apos;babel-loader?presets[]=es2015&amp;presets[]=react&apos;],</span><br><span class="line">        include: path.join(__dirname, &apos;.&apos;)</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">     new webpack.DllReferencePlugin(&#123;</span><br><span class="line">      context: &apos;.&apos;,</span><br><span class="line">      manifest: require(&quot;./build/bundle.manifest.json&quot;),</span><br><span class="line">        &#125;),</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p><code>webpack.DllReferencePlugin</code>的选项中：</p>
<ul>
<li><strong>context</strong>：需要跟之前保持一致，这个用来指导webpack匹配<code>manifest.json</code>中库的路径；</li>
<li><strong>manifest</strong>：用来引入刚才输出的<code>manifest.json</code>文件。</li>
</ul>
<h3 id="打包效果对比"><a href="#打包效果对比" class="headerlink" title="打包效果对比"></a>打包效果对比</h3><p>没有<code>webpack.DllReferencePlugin</code>插件，打包时间：<em>6525ms</em>，资源包：<em>main.js 757k</em>。<br><img src="/images/front/withoutDll.png" alt=""><br>配置<code>webpack.DllReferencePlugin</code>插件，打包时间：<em>892ms</em>，资源包：<em>main.js 4.7k</em>。<br><img src="/images/front/dll.png" alt=""><br>通过dllPlugin，打包时间快了5s，资源包少了700k。</p>
<h3 id="demo-地址"><a href="#demo-地址" class="headerlink" title="demo 地址"></a>demo 地址</h3><p><a href="https://github.com/chenchunyong/webpack-dllPlugin" target="_blank" rel="external">https://github.com/chenchunyong/webpack-dllPlugin</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/06/git-refspecs-详解/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="陈春勇">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="陈春勇的博客">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="陈春勇的博客" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/06/git-refspecs-详解/" itemprop="url">
                  git refspecs 详解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-06T13:47:44+08:00">
                2017-01-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/git/" itemprop="url" rel="index">
                    <span itemprop="name">git</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/01/06/git-refspecs-详解/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/06/git-refspecs-详解/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="git-refspecs-详解"><a href="#git-refspecs-详解" class="headerlink" title="git refspecs 详解"></a>git refspecs 详解</h1><p>每个 refspec 都会创建一个本地仓库分支到远程仓库分支的映射。这让通过本地Git命令操作远程分支成为可能，并且配置一些高级的<code>git push</code>与<code>git fetch</code>行为。</p>
<p>假设你像这样添加了一项远程仓库：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add origin git@github.com:schacon/simplegit-progit.git</span><br></pre></td></tr></table></figure></p>
<p>git会在<code>.git/config</code>新增一节点，指定远程的名称（<code>origin</code>），远程仓库URL地址，以及用于操作的refspecs:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[remote &quot;origin&quot;]</span><br><span class="line">       url = git@github.com:schacon/simplegit-progit.git</span><br><span class="line">       fetch = +refs/heads/*:refs/remotes/origin/*</span><br></pre></td></tr></table></figure></p>
<p>refspecs格式是一个可选<code>+</code>接着是<code>&lt;src&gt;:&lt;dst&gt;</code>，其中<code>&lt;src&gt;</code>是远端上的引用格式，<code>&lt;dst&gt;</code>是将要记录在本地的引用格式。可选<code>+</code>号告诉git即使在不能快速演进的情况下，也去强制更新它。</p>
<p>缺省情况下refspec会被<code>git remote add</code> 命令自动生成，git会获取远程上<code>refs/heads/</code>下面的所有引用，并将它写入到本地的<code>refs/remotes/origin</code>。所以，如果远程有一个<code>master</code>分支，在本地可以通过下面的这种方式来访问他的记录：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git log origin/master</span><br><span class="line">$ git log remotes/origin/master</span><br><span class="line">$ git log refs/remotes/origin/master</span><br></pre></td></tr></table></figure></p>
<p>它们全是等价的，因为git会把它们都扩展成<code>resf/remotes/origin/master</code>。<br>如果你想让git每次拉取只拉取远程的<code>master</code>，而不是远程所有分支，你可以把fetch这一行修改成这样：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fetch = +refs/heads/master:refs/remotes/origin/master</span><br></pre></td></tr></table></figure></p>
<p><code>git fetch</code>操作默认fech远端名称为<code>origin</code>。<br>这是<code>git fetch</code>操作对这个远端缺省refspec值。而如果你只想做一次该操作，也可以在命令行指定这个refspecs，如可以这样拉取远程的<code>master</code>分支到本地的<code>origin/mymaster</code>分支：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch origin master:refs/remotes/origin/mymaster</span><br></pre></td></tr></table></figure></p>
<p>你也可以在命令行上指定多个 refspec. 像这样可以一次获取远程的多个分支：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch origin master:refs/remotes/origin/mymaster \</span><br><span class="line">   topic:refs/remotes/origin/topic</span><br><span class="line">From git@github.com:schacon/simplegit</span><br><span class="line"> ! [rejected]        master     -&gt; origin/mymaster  (non fast forward)</span><br><span class="line"> * [new branch]      topic      -&gt; origin/topic</span><br></pre></td></tr></table></figure></p>
<p>在这个例子中， <code>master</code>分支因为不是一个可以快速演进的引用而拉取操作被拒绝。你可以在 refspec 之前使用一个 + 号来重载这种行为。</p>
<p>你也可以在配置文件中指定多个 refspec. 如你想在每次获取时都获取<code>master</code>和<code>experiment</code> 分支，就添加两行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[remote &quot;origin&quot;]</span><br><span class="line">       url = git@github.com:schacon/simplegit-progit.git</span><br><span class="line">       fetch = +refs/heads/master:refs/remotes/origin/master</span><br><span class="line">       fetch = +refs/heads/experiment:refs/remotes/origin/experiment</span><br></pre></td></tr></table></figure></p>
<p>但是这里不能使用部分通配符，像这样就是不合法的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fetch = +refs/heads/qa*:refs/remotes/origin/qa*</span><br></pre></td></tr></table></figure></p>
<h2 id="推送refspecs"><a href="#推送refspecs" class="headerlink" title="推送refspecs"></a>推送refspecs</h2><p>采用命名空间的方式确实很棒，但QA组成员第1次是如何将他们的分支推送到 qa/ 空间里面的呢？答案是你可以使用 refspec 来推送。<br>如果QA组成员想把他们的<code>master</code>分支推送到远程的<code>qa/master</code>分支上，可以这样运行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin master:refs/heads/qa/master</span><br></pre></td></tr></table></figure></p>
<p>如果他们想让 git 每次运行 git push origin 时都这样自动推送，他们可以在配置文件中添加 push 值：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[remote &quot;origin&quot;]</span><br><span class="line">       url = git@github.com:schacon/simplegit-progit.git</span><br><span class="line">       fetch = +refs/heads/*:refs/remotes/origin/*</span><br><span class="line">       push = refs/heads/master:refs/heads/qa/master</span><br></pre></td></tr></table></figure></p>
<p>这样，就会让<code>git push origin</code>缺省就把本地的<code>master</code>分支推送到远程的<code>qa/master</code>分支上。</p>
<h2 id="删除引用"><a href="#删除引用" class="headerlink" title="删除引用"></a>删除引用</h2><p>你也可以使用 refspec 来删除远程的引用，是通过运行这样的命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin :topic</span><br></pre></td></tr></table></figure></p>
<p>因为refspec的格式是<code>&lt;src&gt;:&lt;dst&gt;</code>, 通过把<code>&lt;src&gt;</code>部分留空的方式，这个意思是是把远程的 topic 分支变成空，也就是删除它。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/06/git-refs-详解/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="陈春勇">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="陈春勇的博客">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="陈春勇的博客" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/06/git-refs-详解/" itemprop="url">
                  git refs 详解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-06T10:26:57+08:00">
                2017-01-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/git/" itemprop="url" rel="index">
                    <span itemprop="name">git</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/01/06/git-refs-详解/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/06/git-refs-详解/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="git-refs-详解"><a href="#git-refs-详解" class="headerlink" title="git refs 详解"></a>git refs 详解</h1><h2 id="refs描述"><a href="#refs描述" class="headerlink" title="refs描述"></a>refs描述</h2><p>在 git 中，我们称之为“引用”（references 或者 refs，译者注）。你可以在 .git/refs 目录下面找到这些包含 SHA-1 值的文件。<br>如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.git/refs/</span><br><span class="line">    heads/</span><br><span class="line">        master</span><br><span class="line">        test</span><br><span class="line">    remotes/</span><br><span class="line">        origin/</span><br><span class="line">            master</span><br><span class="line">    tags/</span><br><span class="line">        v0.9</span><br></pre></td></tr></table></figure></p>
<p><strong>heads：</strong>描述当前仓库所有本地分支，每一个文件名对应相应的分支，文件内部存储了当前分支最新的commit hash值。为了证实这点，你可以在git仓库中执行以下两段代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/refs/heads/master</span><br><span class="line"></span><br><span class="line">$ git log -1 master</span><br></pre></td></tr></table></figure></p>
<p>由<code>cat</code> 得到的commit hash 与 <code>git log</code>得到的hash值是一致的。</p>
<p>因此新建分支，只要往<code>.git/refs/heads/分支名</code>写入commit hash值就是这么简单。</p>
<p><strong>tags：</strong>描述当前仓库的tag信息，其工作原理与heads一致。</p>
<p><strong>remotes：</strong>remotes文件夹将所有由<code>git remote</code> 命令创建的所有远程分支存储为单独的子目录。在每个子目录中，可以发现被fetch进仓库的对应的远程分支。</p>
<h2 id="特殊的引用（Refs）"><a href="#特殊的引用（Refs）" class="headerlink" title="特殊的引用（Refs）"></a>特殊的引用（Refs）</h2><p>除了引用目录外，还有一些特别的引用存在与.git路径顶部。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.git</span><br><span class="line">    HEAD</span><br><span class="line">    FETCH_HEAD</span><br><span class="line">    ORIG_HEAD</span><br><span class="line">    MERGE_HEAD</span><br></pre></td></tr></table></figure></p>
<p><strong>HEAD：</strong>当前检出的commit/branch。<code>HEAD</code>文件存储的是refs/heads/分支的引用。<br>可以看到<code>HEAD</code> 文件格式为：<code>ref: refs/heads/分支名称（当前分支）</code>。<br>当需要时这些 引用 会被创建或更新。例如，当执行<code>git pull</code>命令时，首先会执行 <code>git fetch</code>命令，此时会更新 <code>FETCH_HEAD</code> 引用，其后执行 <code>git merge FETCH_HEAD</code> 命令将获取的分支导入仓库。当然上述这些引用可以像普通引用一样使用，我想你一定使用过HEAD作为参数吧。<br>由于你仓库的类型与状态的差异，这些文件会包含不同的内容。HEAD引用有可能是一个指向其他引用的象征性的引用，也可能是一个commit哈希。当你在主分支下，查看你的HEAD文件内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br><span class="line">$ cat .git/HEAD</span><br></pre></td></tr></table></figure></p>
<p>你将看到<code>ref: refs/heads/master</code>，这意味着HEAD指向<code>refs/heads/master</code>的引用。这就是为什么git能获悉当前主分支被检出了的原因。如果切换到其他分支，HEAD的内容将被更新为指向那个分支。但是如果你在commit的层面使用<code>check out</code>而非分支层面，HEAD的内容将会是一个commit哈希而非引用。这就是为什么Git能获悉它处在独立的状态的原因。<br><strong>FETCH_HEAD：</strong>最新从远程分支获取的分支。<code>FETCH_HEAD</code> 文件存储的是远程分支的最新的commit信息。</p>
<p><strong>ORIG_HEAD：</strong>作为备份指向危险操作前的HEAD<br><strong>MERGE_HEAD：</strong>使用<code>git merge</code>命令合并进当前分支的提交</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/04/webpack-常用plugin/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="陈春勇">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="陈春勇的博客">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="陈春勇的博客" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/04/webpack-常用plugin/" itemprop="url">
                  webpack 常用plugin
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-04T11:31:06+08:00">
                2017-01-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/01/04/webpack-常用plugin/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/04/webpack-常用plugin/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="webpack-常用plugin"><a href="#webpack-常用plugin" class="headerlink" title="webpack 常用plugin"></a>webpack 常用plugin</h1><p>记录webpack常用plugin使用</p>
<h2 id="DefinePlugin"><a href="#DefinePlugin" class="headerlink" title="DefinePlugin"></a>DefinePlugin</h2><p>用来定义全局变量，在webpack打包的时候会对这些变量做替换。<br>demo:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> webpack.DefinePlugin(&#123;</span><br><span class="line">            <span class="string">'process.env'</span>: <span class="built_in">JSON</span>.stringify(<span class="string">'DEV'</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(process.env);</span><br></pre></td></tr></table></figure></p>
<p>编译完成后，<code>process.env</code>会被编译成DEV。 </p>
<h2 id="ExtractTextPlugin"><a href="#ExtractTextPlugin" class="headerlink" title="ExtractTextPlugin"></a>ExtractTextPlugin</h2><p>把文件中的css样式剥离出来，单独为一个css文件。<br>demo:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> ExtractTextPlugin(<span class="string">'module.css'</span>),</span><br><span class="line">    ]</span><br><span class="line">    loaders: [&#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        loader: ExtractTextPlugin.extract(<span class="string">'style-loader'</span>, <span class="string">'css-loader!postcss-loader'</span>),</span><br><span class="line">  &#125;],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>把文件中的css剥离出来成单独的module.css文件。</p>
<p><strong>NOTE</strong>:<br>一个entry生成一个文件，当多个entry的时候，可以用<code>[name]/[id]/[contenthash]</code>来生成多个文件。<br><code>id</code>: 插件实例的唯一标识，自动生成<br><code>filename</code>: 输出的filename，可以通过[name]/[id]/[contenthash]自定义filename<br><code>options.allChunks</code> 提取所有的chunk（默认只提取initial chunk）<br><code>options.disable</code> disable该插件</p>
<p>文／齐修_qixiuss（简书作者）<br>原文链接：<a href="http://www.jianshu.com/p/1eefaeaf6874" target="_blank" rel="external">http://www.jianshu.com/p/1eefaeaf6874</a><br>著作权归作者所有，转载请联系作者获得授权，并标注“简书作者”。</p>
<h2 id="NoErrorsPlugin"><a href="#NoErrorsPlugin" class="headerlink" title="NoErrorsPlugin"></a>NoErrorsPlugin</h2><p>跳过编译时出错的代码并记录，使编译后运行时的包不会发生错误。</p>
<h2 id="CommonsChunkPlugin"><a href="#CommonsChunkPlugin" class="headerlink" title="CommonsChunkPlugin"></a>CommonsChunkPlugin</h2><p>提取代码中的公共模块，然后将公共模块打包到一个独立的文件中，以便在其他的入口和模块中使用。<br>demo:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry:[<span class="string">'index1.js'</span>,<span class="string">'index2.js'</span>],</span><br><span class="line">  plugins: [</span><br><span class="line">   <span class="keyword">new</span> CommonsChunkPlugin(&#123;</span><br><span class="line">      name:<span class="string">"entry"</span>,</span><br><span class="line">      filename:<span class="string">"common.js"</span>,<span class="comment">//忽略则以name为输出文件的名字，否则以此为输出文件名字</span></span><br><span class="line">      minChunks:<span class="number">2</span>,<span class="comment">// 最小引用2次</span></span><br><span class="line">   &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>把index1.js，index2.js公用的js抽取出来，打包成单独文件common.js。<br><strong>NOTE</strong>: CommonsChunkPlugin此插件存在的问题：</p>
<ol>
<li>如果entry只有一个,生成的common.js内容为空。</li>
<li>编译时，每次都会重新编译，编译时间长，无法缓存编译的内容</li>
<li>common.js是由webpack控制<br><strong>参考</strong>：<a href="http://www.jianshu.com/p/ee372e344d6d" target="_blank" rel="external">http://www.jianshu.com/p/ee372e344d6d</a></li>
</ol>
<h2 id="DedupePlugin"><a href="#DedupePlugin" class="headerlink" title="DedupePlugin"></a>DedupePlugin</h2><p>有些JS库有自己的依赖树，并且这些库可能有交叉的依赖，DedupePlugin可以找出他们并删除重复的依赖。</p>
<h2 id="UglifyJsPlugin"><a href="#UglifyJsPlugin" class="headerlink" title="UglifyJsPlugin"></a>UglifyJsPlugin</h2><p>压缩js文件。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry:[<span class="string">'index1.js'</span>],</span><br><span class="line">  plugins: [</span><br><span class="line">   <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(&#123;</span><br><span class="line">      compress: &#123;</span><br><span class="line">        warnings: VERBOSE,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>对index1.js进行压缩。</p>
<h2 id="OccurenceOrderPlugin"><a href="#OccurenceOrderPlugin" class="headerlink" title="OccurenceOrderPlugin"></a>OccurenceOrderPlugin</h2><p>为组件分配ID，通过这个插件webpack可以分析和优先考虑使用最多的模块，并为它们分配最小的ID。（老实说，不知道分配最小ID有什么作用）。</p>
<h2 id="HotModuleReplacementPlugin"><a href="#HotModuleReplacementPlugin" class="headerlink" title="HotModuleReplacementPlugin"></a>HotModuleReplacementPlugin</h2><p>热更新插件，代码发生变化，自动替换到页面。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry:[<span class="string">'webpack/hot/dev-server'</span>, <span class="string">'webpack-hot-middleware/client?reload=true'</span>,<span class="string">'index1.js'</span>],</span><br><span class="line">  plugins: [</span><br><span class="line">   <span class="keyword">new</span> webpack.HotModuleReplacementPlugin(),</span><br><span class="line">  ],</span><br><span class="line">  loaders: [&#123;</span><br><span class="line">    test: <span class="regexp">/\.jsx?$/</span>,</span><br><span class="line">    loaders: [<span class="string">'react-hot'</span>],</span><br><span class="line">    exclude: <span class="string">'/node_modules/'</span>,</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>express 服务配置<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> WebpackDevMiddleware = <span class="built_in">require</span>(<span class="string">'webpack-dev-middleware'</span>)</span><br><span class="line"><span class="keyword">var</span> WebpackHotMiddleware = <span class="built_in">require</span>(<span class="string">'webpack-hot-middleware'</span>)</span><br><span class="line"><span class="keyword">var</span> config = <span class="built_in">require</span>(<span class="string">'./config/webpack.dev.config'</span>)</span><br><span class="line"><span class="keyword">var</span> compiler = webpack(config)</span><br><span class="line">app = express()</span><br><span class="line">app.use(WebpackDevMiddleware(compiler, &#123;</span><br><span class="line">  publicPath: config.output.publicPath,</span><br><span class="line">  stats: &#123; colors: <span class="literal">true</span> &#125;</span><br><span class="line">&#125;))</span><br><span class="line">app.use(WebpackHotMiddleware(compiler))</span><br></pre></td></tr></table></figure></p>
<p>如果前端框架采用外部引用react的方式，那么需要在入口index1.js增加hot replace 配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if (module.hot) &#123;</span><br><span class="line">  require(&apos;react-hot-loader/Injection&apos;).RootInstanceProvider.injectProvider(&#123;</span><br><span class="line">    getRootInstances: () =&gt; [rootInstance],</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="HtmlWebpackPlugin"><a href="#HtmlWebpackPlugin" class="headerlink" title="HtmlWebpackPlugin"></a>HtmlWebpackPlugin</h2><p>这个插件用来简化创建服务于 webpack bundle 的 HTML 文件，尤其是对于在文件名中包含了 hash 值，而这个值在每次编译的时候都发生变化的情况。你既可以让这个插件来帮助你自动生成 HTML 文件，也可以使用 lodash 模板加载生成的 bundles，或者自己加载这些 bundles。<br>demo:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry:[<span class="string">'index1.js'</span>],</span><br><span class="line">  plugins: [</span><br><span class="line">   <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      title: <span class="string">'My App'</span>,</span><br><span class="line">      filename: <span class="string">'index.html'</span>,</span><br><span class="line"></span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>把index1.js打包后，放到index.html中。</p>
<h3 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h3><ul>
<li>title: 用来生成页面的 title 元素</li>
<li>filename: 输出的 HTML 文件名，默认是 index.html, 也可以直接配置带有子目录。</li>
<li>template: 模板文件路径，支持加载器，比如 html!./index.html</li>
<li>inject: true | ‘head’ | ‘body’ | false  ,注入所有的资源到特定的 template 或者 templateContent 中，如果设置为 true 或者 body，所有的 javascript 资源将被放置到 body 元素的底部，’head’ 将放置到 head 元素中。</li>
<li>favicon: 添加特定的 favicon 路径到输出的 HTML 文件中。</li>
<li>minify: {} | false , 传递 html-minifier 选项给 minify 输出</li>
<li>hash: true | false, 如果为 true, 将添加一个唯一的 webpack 编译 hash 到所有包含的脚本和 CSS 文件，对于解除 cache 很有用。</li>
<li>cache: true | false，如果为 true, 这是默认值，仅仅在文件修改之后才会发布文件。</li>
<li>showErrors: true | false, 如果为 true, 这是默认值，错误信息会写入到 HTML 页面中</li>
<li>chunks: 允许只添加某些块 (比如，仅仅 unit test 块)</li>
<li>chunksSortMode: 允许控制块在添加到页面之前的排序方式，支持的值：’none’ | ‘default’ | {function}-default:’auto’</li>
<li>excludeChunks: 允许跳过某些块，(比如，跳过单元测试的块) </li>
</ul>
<h2 id="assets-webpack-plugin"><a href="#assets-webpack-plugin" class="headerlink" title="assets-webpack-plugin"></a>assets-webpack-plugin</h2><p>通过webpack的 assets-webpack-plugin 插件生成一个记录了版本号的文件。其中一个重要功能是可以根据<code>asset.json</code>实现在线发现，例如可以把<code>asset.json</code>存在数据中，web服务器可以获取最新的<code>asset.json</code>实现实时发布。<br>demo:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">var</span> AssetsPlugin = <span class="built_in">require</span>(<span class="string">'assets-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">var</span> assetsPluginInstance = <span class="keyword">new</span> AssetsPlugin()</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        one: [<span class="string">'src/one.js'</span>],</span><br><span class="line">        two: [<span class="string">'src/two.js'</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.join(__dirname, <span class="string">"public"</span>, <span class="string">"js"</span>),</span><br><span class="line">        filename: <span class="string">"[name]-bundle-[hash].js"</span>,</span><br><span class="line">        publicPath: <span class="string">"/js/"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [assetsPluginInstance]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>生成的<code>asset.json</code>内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;one&quot;: &#123;</span><br><span class="line">        &quot;js&quot;: &quot;/js/one_2bb80372ebe8047a68d4.bundle.js&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;two&quot;: &#123;</span><br><span class="line">        &quot;js&quot;: &quot;/js/two_2bb80372ebe8047a68d4.bundle.js&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/03/babel-polyfill-使用/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="陈春勇">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="陈春勇的博客">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="陈春勇的博客" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/03/babel-polyfill-使用/" itemprop="url">
                  babel polyfill 使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-03T13:57:59+08:00">
                2017-01-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/01/03/babel-polyfill-使用/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/03/babel-polyfill-使用/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="babel-polyfill-使用"><a href="#babel-polyfill-使用" class="headerlink" title="babel polyfill 使用"></a>babel polyfill 使用</h1><p>Babel默认只转换新的JavaScript句法（syntax），而不转换新的API，比如Iterator、Generator、Set、Maps、Proxy、Reflect、Symbol、Promise等全局对象，以及一些定义在全局对象上的方法（比如Object.assign）都不会转码。<br>举例来说，ES6在Array对象上新增了Array.from方法。Babel就不会转码这个方法。如果想让这个方法运行，必须使用babel-polyfill，为当前环境提供一个垫片。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save babel-polyfill</span><br></pre></td></tr></table></figure>
<p>然后，在脚本头部，加入如下一行代码。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'babel-polyfill'</span>;</span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'babel-polyfill'</span>);</span><br></pre></td></tr></table></figure>
<h2 id="babel-polyfill-问题"><a href="#babel-polyfill-问题" class="headerlink" title="babel polyfill 问题"></a>babel polyfill 问题</h2><p>babel polyfill提供了全局访问API，如Promise，Set 以及Map，但是polyfill所提供的api可能会污染到全局作用域，特别在你把代码打包为第三方库给其他人使用时，或者你无法控制你代码的运行环境时，都会存在问题。</p>
<p>那么如何避免上述问题呢？babel提供了<code>transform-runtime插件</code>来避免此问题，<code>transform-runtime</code>插件提供了一个沙箱机制来避免全局变量的污染。</p>
<p>需要注意的是<code>transform-runtime</code>依赖于<code>babel-runtime</code>。</p>
<h2 id="transform-runtime-使用"><a href="#transform-runtime-使用" class="headerlink" title="transform-runtime 使用"></a>transform-runtime 使用</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><ol>
<li><p>development dependencies</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save-dev babel-plugin-transform-runtime</span><br></pre></td></tr></table></figure>
</li>
<li><p>production dependencies</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save babel-runtime</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>通常来说，<code>transform-runtime</code>插件只用在开发环境中，不需要打包到生产包，而<code>transform-runtime</code>所依赖的<code>babel-runtime</code>则需要打包到生产包中。</p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><ol>
<li><p>.babelrc 配置方式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// without options</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"plugins"</span>: [<span class="string">"transform-runtime"</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// with options</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"plugins"</span>: [</span><br><span class="line">    [<span class="string">"transform-runtime"</span>, &#123;</span><br><span class="line">      <span class="string">"helpers"</span>: <span class="literal">false</span>, <span class="comment">// defaults to true</span></span><br><span class="line">      <span class="string">"polyfill"</span>: <span class="literal">false</span>, <span class="comment">// defaults to true</span></span><br><span class="line">      <span class="string">"regenerator"</span>: <span class="literal">true</span>, <span class="comment">// defaults to true</span></span><br><span class="line">      <span class="string">"moduleName"</span>: <span class="string">"babel-runtime"</span> <span class="comment">// defaults to "babel-runtime"</span></span><br><span class="line">    &#125;]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>babel CLI </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">babel --plugins transform-runtime script.js</span><br></pre></td></tr></table></figure>
</li>
<li><p>NODE 环境</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">"babel-core"</span>).transform(<span class="string">"code"</span>, &#123;</span><br><span class="line">  plugins: [<span class="string">"transform-runtime"</span>]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/21/解决生产环境js无法调试问题/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="陈春勇">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="陈春勇的博客">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="陈春勇的博客" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/21/解决生产环境js无法调试问题/" itemprop="url">
                  解决生产环境js无法调试问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-21T15:45:49+08:00">
                2016-12-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2016/12/21/解决生产环境js无法调试问题/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/21/解决生产环境js无法调试问题/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="解决生产环境js无法调试问题"><a href="#解决生产环境js无法调试问题" class="headerlink" title="解决生产环境js无法调试问题"></a>解决生产环境js无法调试问题</h1><p><strong>demo</strong>：<a href="https://github.com/chenchunyong/source-map-demo.git" target="_blank" rel="external">https://github.com/chenchunyong/source-map-demo.git</a></p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>前端开发中，开发环境与生产环境的代码往往不一致，生产环境的代码通过构建工具进行合并，混淆，压缩等操作。不过通过构建工具生成的js代码可读性差，不利于维护、排查问题。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>首先，通过构建工具生成两个生产js文件，如下:</p>
<ul>
<li>所有用户可见js，比如bundle.js</li>
<li>特定用户js，排查问题用，此js文件会加入sourcemap引用，比如说bundle.debug.js</li>
</ul>
<p>然后，根据用户输入的url是否包含sourcemap参数，来判断是否启动sourcemap调试功能。比如如果包含sourcemap参数，则引入bundle.debug.js，否则引入bundle.js。</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><ol>
<li><p>克隆</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/chenchunyong/source-map-demo.git</span><br></pre></td></tr></table></figure>
</li>
<li><p>进入source-map-demo目录，安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure>
</li>
<li><p>打包js文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run bundle</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>输入<a href="http://localhost:3000" target="_blank" rel="external">http://localhost:3000</a> 或者<a href="http://localhost:3000?sourcemap=true" target="_blank" rel="external">http://localhost:3000?sourcemap=true</a> 查看效果。</p>
<h2 id="效果对比"><a href="#效果对比" class="headerlink" title="效果对比"></a>效果对比</h2><ol>
<li><p>输入<a href="http://localhost:3000" target="_blank" rel="external">http://localhost:3000</a><br><img src="/images/front/online.gif" alt=""></p>
</li>
<li><p>输入<a href="http://localhost:3000?sourcemap=true" target="_blank" rel="external">http://localhost:3000?sourcemap=true</a><br><img src="/images/front/debug.gif" alt=""></p>
</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/12/find-与xargs命令使用/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="陈春勇">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="陈春勇的博客">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="陈春勇的博客" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/12/find-与xargs命令使用/" itemprop="url">
                  find 与xargs命令使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-12T17:28:50+08:00">
                2016-12-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2016/12/12/find-与xargs命令使用/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/12/find-与xargs命令使用/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="find-与xargs命令使用"><a href="#find-与xargs命令使用" class="headerlink" title="find 与xargs命令使用"></a>find 与xargs命令使用</h1><h2 id="find"><a href="#find" class="headerlink" title="find"></a>find</h2><p>find命令是一个无处不在命令，是linux中最有用的命令之一。find命令用于：在一个目录（及子目录）中搜索文件，你可以指定一些匹配条件，如按文件名、文件类型、用户甚至是时间戳查找文件。</p>
<p>find命令常用的格式如下：</p>
<p><strong>find   path   -option   [   -print ]   [ -exec   -ok   command ]   {} \;</strong></p>
<p>常用命令详解：</p>
<ul>
<li>path：find命令所查找的目录路径</li>
<li>-options：指定find命令的常用选项</li>
<li>-print：find命令将匹配的文件输出到标准输出</li>
<li>-exec：find命令对匹配的文件执行该参数所给出的shell命令。相应命令的形式为’command’ {  } \;</li>
<li>-ok：和-exec的作用相同，只不过以一种更为安全的模式来执行该参数所给出的shell命令，在执行每一个命令之前，都会给出提示，让用户来确定是否执行。</li>
</ul>
<p>其中options中的常用选项：</p>
<ul>
<li>-name：按照文件名查找文件，支持正则表达式。例如：<code>find . -name “test*”</code>，在当前目录以及子目录查找名称为包含test的文件</li>
<li>-perm：按照文件的权限查找文件。例如：<code>find . -perm 700</code>，在当前目录以及子目录下查找文件权限为当前用户可读、可写、可执行的文件。</li>
<li>-prune：查看的时候忽略某个文件夹。例如：<code>find .  -path &quot;/test/prune&quot; -prune</code>，在当前目录查找，且不在/test/prune目录下的文件。</li>
<li>-type：在当前目录以及子目录下查找某个类型的文件。例如：<code>find . -type l</code>，在当前目录以及子目录下查找是软链接文件。</li>
</ul>
<h2 id="find与xargs"><a href="#find与xargs" class="headerlink" title="find与xargs"></a>find与xargs</h2><p>在使用find命令的-exec选项处理匹配到的文件时， find命令将所有匹配到的文件一起传递给exec执行。但有些系统对能够传递给exec的命令长度有限制，这样在find命令运行几分钟之后，就会出现溢出错误。错误信息通常是“参数列太长”或“参数列溢出”。这就是xargs命令的用处所在，特别是与find命令一起使用。</p>
<p>find命令把匹配到的文件传递给xargs命令，而xargs命令每次只获取一部分文件而不是全部，不像-exec选项那样。这样它可以先处理最先获取的一部分文件，然后是下一批，并如此继续下去。</p>
<p>在有些系统中，使用-exec选项会为处理每一个匹配到的文件而发起一个相应的进程，并非将匹配到的文件全部作为参数一次执行；这样在有些情况下就会出现进程过多，系统性能下降的问题，因而效率不高；</p>
<p>而使用xargs命令则只有一个进程。另外，在使用xargs命令时，究竟是一次获取所有的参数，还是分批取得参数，以及每一次获取参数的数目都会根据该命令的选项及系统内核中相应的可调参数来确定。</p>
<p>例如：<code>find . -type f  | xargs file</code> 查找系统中的每一个普通文件，然后使用xargs命令来测试它们分别属于哪类文件。</p>
<p><code>find . -name &quot;test*&quot;  | xargs echo &quot;&quot; &gt;test.log</code> 在当前目录以及子目录中查找包含test的文件，且把相关信息写到test.log中</p>
<p><code>find . -type f -print | xargs grep &quot;test&quot;</code> 用grep命令在所有的普通文件中搜索test这个词</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="陈春勇" />
          <p class="site-author-name" itemprop="name">陈春勇</p>
          <p class="site-description motion-element" itemprop="description">宽恕不会改变那个过去,却能开阔你的未来</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">19</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">12</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/chenchunyong" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/windavidking" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/chen-feng-xie" target="_blank" title="Zhihu">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Zhihu
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">陈春勇</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"windavid"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  








  
  

  

  

  

  


</body>
</html>
